<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:lang="${#locale.language}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="#{app.title}">Portfolio</title>
    <link rel="icon" type="image/png" th:href="@{/images/logo.png}">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <style>
        body{
            font-family:Inter,sans-serif;
            background:#f8f9fa;
            min-height:100vh;
            display:flex;
            flex-direction:column;
        }

        /* NAVBAR */
        .navbar-nav .nav-link{color:rgba(255,255,255,.8)!important}
        .navbar-nav .nav-link:hover{color:#fff!important}
        .lang-link{color:#fff;font-size:.85rem;opacity:.6;background:none;border:none;cursor:pointer}
        .lang-active{opacity:1;font-weight:800;border-bottom:2px solid #0d6efd}

        /* BADGES */
        .tech-badges{
            display:flex;
            justify-content:center;
            gap:10px;
            margin-top:10px;
            flex-wrap:wrap;
        }
        .tech-badges .badge{
            font-size:0.8rem;
            padding:6px 12px;
            border-radius:999px;
        }

        /* UPDATE BADGE */
        .update-badge{
            padding:6px 14px;
            border-radius:999px;
            background:#e0f2fe;
            color:#0369a1;
            font-weight:600;
        }
        .update-badge.updated{animation:pulse 1.2s ease}
        @keyframes pulse{
            0%{background:#bbf7d0}
            50%{background:#86efac}
            100%{background:#e0f2fe}
        }

        /* ECONOMY LIST */
        .economy-card{
            background:#fff;
            border-radius:20px;
            padding:22px;
            display:flex;
            align-items:center;
            justify-content:space-between;
            box-shadow:0 10px 25px rgba(0,0,0,.05);
            flex-wrap:wrap;
        }
        .eco-left{display:flex;align-items:center;gap:16px;min-width:260px}
        .eco-left i{font-size:2.3rem}
        .eco-label{font-size:1.25rem;font-weight:700}
        .eco-prices{display:flex;gap:12px}
        .price-box{
            border:1px solid #edf2f7;
            padding:10px 16px;
            border-radius:14px;
            text-align:center;
            min-width:120px;
        }
        .price-box span{
            font-size:.7rem;
            color:#94a3b8;
            font-weight:700;
            text-transform:uppercase;
        }
        .buy{color:#16a34a;font-weight:800;font-size:1.2rem}
        .sell{color:#dc2626;font-weight:800;font-size:1.2rem}
        .eco-change{min-width:90px;text-align:right;font-weight:700}
        .up{color:#16a34a}
        .down{color:#dc2626}

        /* FOOTER */
        .custom-footer{
            background:#020617;
            color:#f8fafc;
            padding:40px 0;
            margin-top:auto;
            text-align:center;
        }
        .footer-content{display:flex;flex-direction:column;gap:12px;align-items:center}
        .footer-email{color:#3b82f6;text-decoration:none}
        .footer-socials{display:flex;gap:20px}
        .footer-socials a{color:#3b82f6;text-decoration:none}
        .footer-socials a:hover{color:#fff}
    </style>
</head>

<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" th:href="@{/}">
            <span style="background:#0d6efd;padding:5px 12px;border-radius:8px;font-weight:bold;">A</span>
        </a>

        <button class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
                <li class="nav-item"><a class="nav-link" th:href="@{/}" th:text="#{menu.home}"></a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/about}" th:text="#{menu.about}"></a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/cv/download}" th:text="#{menu.cv}"></a></li>
            </ul>

            <div class="d-flex gap-2">
                <button onclick="changeLanguage('tr')" class="lang-link" th:classappend="${#locale.language=='tr'}?'lang-active':''">TR</button>|
                <button onclick="changeLanguage('en')" class="lang-link" th:classappend="${#locale.language=='en'}?'lang-active':''">EN</button>
            </div>
        </div>
    </div>
</nav>

<!-- CONTENT -->
<main class="container my-5">

    <div class="text-center mb-4">
        <h1 th:text="#{home.welcome}"></h1>

        <p class="text-muted" th:text="#{home.info}"></p>

        <!-- ðŸ”° TECH BADGES -->
        <div class="tech-badges">
            <span class="badge bg-success" th:text="#{home.badge.spring}"></span>
            <span class="badge bg-primary" th:text="#{home.badge.java}"></span>
        </div>

        <div class="d-flex justify-content-center gap-2 flex-wrap mt-3">
            <span th:text="#{economy.sort.label}"></span>

            <select id="sortField" class="form-select form-select-sm w-auto" onchange="applyFilters()">
                <option value="sell" th:text="#{economy.sort.sell}"></option>
                <option value="buy" th:text="#{economy.sort.buy}"></option>
                <option value="change" th:text="#{economy.sort.change}"></option>
            </select>

            <select id="sortDir" class="form-select form-select-sm w-auto" onchange="applyFilters()">
                <option value="desc" th:text="#{economy.sort.dir.desc}"></option>
                <option value="asc" th:text="#{economy.sort.dir.asc}"></option>
            </select>

            <input id="searchInput"
                   type="text"
                   class="form-control form-control-sm w-auto"
                   th:placeholder="#{economy.search.placeholder}"
                   oninput="applyFilters()">
        </div>

        <div id="last-update"
             class="update-badge mt-3"
             th:data-label="#{economy.lastUpdate}">
        </div>
    </div>

    <div class="row g-4" id="economy-container"></div>
</main>

<!-- FOOTER -->
<footer class="custom-footer">
    <div class="container">
        <div class="footer-content">
            <div th:text="#{footer.copy}"></div>
            <a href="mailto:azatates4977@gmail.com" class="footer-email" th:text="#{footer.contact}"></a>
            <div class="footer-socials">
                <a href="https://github.com/azatates7" target="_blank"><i class="fab fa-github"></i> GitHub</a>
                <a href="https://linkedin.com/in/azatates7" target="_blank"><i class="fab fa-linkedin"></i> LinkedIn</a>
            </div>
        </div>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script th:inline="javascript">
    let allAssets = [];
    let labels = {};

    function changeLanguage(lang) {
        const url = new URL(window.location.href);
        url.searchParams.set('lang', lang);
        window.location.href = url.toString();
    }

    window.addEventListener('DOMContentLoaded', () => {
        const url = new URL(window.location.href);
        if (url.searchParams.has('lang')) {
            url.searchParams.delete('lang');
            window.history.replaceState({}, document.title, url.pathname);
        }
    });

    function applyFilters(){
        const field = document.getElementById('sortField').value;
        const dir = document.getElementById('sortDir').value;
        const q = document.getElementById('searchInput').value.toLowerCase();

        let list = allAssets.filter(a => a.name.toLowerCase().includes(q));

        list.sort((a,b)=>{
            let A = field==='change' ? Math.abs(a[field]) : a[field];
            let B = field==='change' ? Math.abs(b[field]) : b[field];
            return dir==='asc' ? A-B : B-A;
        });

        renderAssets(list);
    }

    function renderAssets(list){
        const c = document.getElementById('economy-container');
        c.innerHTML = '';
        list.forEach(a=>{
            const up = a.change >= 0;
            c.innerHTML += `
        <div class="col-12">
            <div class="economy-card">
                <div class="eco-left">
                    <i class="fas ${a.icon}" style="color:${a.color}"></i>
                    <div class="eco-label">${a.name}</div>
                </div>
                <div class="eco-prices">
                    <div class="price-box">
                        <span>${labels.buy}</span>
                        <div class="buy">â‚º${a.buy.toFixed(2)}</div>
                    </div>
                    <div class="price-box">
                        <span>${labels.sell}</span>
                        <div class="sell">â‚º${a.sell.toFixed(2)}</div>
                    </div>
                </div>
                <div class="eco-change ${up?'up':'down'}">
                    ${up?'â–²':'â–¼'} %${Math.abs(a.change).toFixed(2)}
                </div>
            </div>
        </div>`;
        });
    }

    async function fetchEconomyData(){
        labels = {
            buy: /*[[#{economy.buy}]]*/ 'AlÄ±ÅŸ',
            sell: /*[[#{economy.sell}]]*/ 'SatÄ±ÅŸ',
            kwd: /*[[#{asset.kwd}]]*/ 'Kuveyt DinarÄ±'
        };

        const res = await fetch('https://cdn.jsdelivr.net/npm/@fawazahmed0/currency-api@latest/v1/currencies/usd.json');
        const data = await res.json();
        const r = data.usd;
        const t = r.try;

        const gram = ((1/r.xau)/31.1035)*t;
        const silver = ((1/r.xag)/31.1035)*t;
        const spread = 0.004;
        const calc = v => ({buy:v*(1-spread), sell:v*(1+spread)});
        const ch = () => Math.random()*1-0.5;

        allAssets = [
            {name:'Dolar',icon:'fa-dollar-sign',color:'#16a34a',...calc(t),change:ch()},
            {name:'Euro',icon:'fa-euro-sign',color:'#2563eb',...calc(t/r.eur),change:ch()},
            {name:labels.kwd,icon:'fa-money-bill-wave',color:'#0f766e',...calc(t/r.kwd),change:ch()},
            {name:'Gram AltÄ±n',icon:'fa-coins',color:'#f1c40f',...calc(gram),change:ch()},
            {name:'Kesme AltÄ±n',icon:'fa-square',color:'#d4af37',...calc(gram*1.001),change:ch()},
            {name:'YarÄ±m AltÄ±n',icon:'fa-circle-half-stroke',color:'#d4af37',...calc(gram*3.26),change:ch()},
            {name:'GÃ¼mÃ¼ÅŸ',icon:'fa-leaf',color:'#9ca3af',...calc(silver),change:ch()},
            {name:'Bulgar LevasÄ±',icon:'fa-building-columns',color:'#16a085',...calc(t/r.bgn),change:ch()},
            {name:'Rus Rublesi',icon:'fa-ruble-sign',color:'#c0392b',...calc(t/r.rub),change:ch()},
            {name:'Bitcoin',icon:'fa-bitcoin',color:'#f59e0b',...calc(t/r.btc),change:ch()}
        ];

        applyFilters();

        const el = document.getElementById('last-update');
        const label = el.dataset.label;
        const locale = /*[[${#locale.language}]]*/ 'tr';
        const dateFmt = new Intl.DateTimeFormat(
            locale==='tr'?'tr-TR':'en-US',
            {day:'2-digit',month:'2-digit',year:'numeric',hour:'2-digit',minute:'2-digit',second:'2-digit'}
        );
        el.textContent = label.replace('{0}', dateFmt.format(new Date()));
        el.classList.add('updated');
    }

    fetchEconomyData();
</script>
</body>
</html>
